Here is a collection of matchers (for rspec) and steps (for Cucumber) for making testing emails a little easier.

These were originally written for the Story Runner and later translated over...  

This probably has a few rough edges.. any commits to smooth out the problems would be appreciated.


To use these in your features put the following in your env.rb:

require 'email_spec_feature_setup'

 * Make sure this require is after you require cucumber/rails/world.

The matchers and helpers should be available for your specs by default, but you need to include them into the example groups you want to use them in.  To include them in all of your specs you can do this in your spec_helper.rb:

Spec::Runner.configure do |config|
  config.include(EmailSpec::Helpers)
  config.include(EmailSpec::Matchers)
end


For example:

Scenario: A new person signs up
      Given I am at "/"
      And a clear email queue
      When I fill in "Email" with "quentin@example.com"
      And I fill in "Password" with "monkey"
      And I fill in "Password confirmation" with "monkey"
      And I press "Sign up"
      Then "quentin@example.com" should receive 1 email
      And "quentin@example.com" should have 1 email
      And "foo@bar.com" should not receive an email
      When I open the email
      Then I should see "confirm" in the email
      And I should see "Account confirmation" in the subject
      When I follow "confirm" in the email
      Then I should see "Confirm your new account"

To see the app that implements this feature check out:
http://github.com/bmabey/email-spec-sample-app/tree/master
